--// SERVICES
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local ProximityPromptService = game:GetService("ProximityPromptService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

--// CONFIG
local ConfigName = "LimitedHub_Config.json"

--// SETTINGS
local Settings = {
    LagEnabled = false,
    IsAutoLagging = false,
    AntiDeathEnabled = true,

    PacketRate = 5,
    MaxPacketRate = 50,

    SpeedEnabled = false,
    SpeedValue = 27,
    MinSpeed = 27,
    MaxSpeed = 55,

    AutoLagOnPrompt = false,
    LagStartDelay = 0.5,
    LagDuration = 1.0,

    GuiPos = { X = nil, Y = nil }
}

--// SAVE / LOAD
local function SaveConfig()
    if writefile then
        writefile(ConfigName, HttpService:JSONEncode(Settings))
    end
end

local function LoadConfig()
    if readfile and isfile and isfile(ConfigName) then
        local data = HttpService:JSONDecode(readfile(ConfigName))
        for k,v in pairs(data) do
            if Settings[k] ~= nil then
                Settings[k] = v
            end
        end
    end
end

LoadConfig()

--// CLEAN OLD UI
for _,v in ipairs(CoreGui:GetChildren()) do
    if v.Name == "FrostHubUI" then v:Destroy() end
end

--// THEME
local Theme = {
    BG = Color3.fromRGB(18, 12, 28),
    Accent = Color3.fromRGB(170, 120, 255),
    AccentDark = Color3.fromRGB(95, 70, 160),
    Text = Color3.fromRGB(240,240,255),
    SubText = Color3.fromRGB(180,170,210)
}

--// GUI
local GUI = Instance.new("ScreenGui")
GUI.Name = "FrostHubUI"
GUI.IgnoreGuiInset = true
GUI.ResetOnSpawn = false
GUI.Parent = CoreGui

local Main = Instance.new("Frame")
Main.Size = UDim2.new(0,230,0,360)
Main.BackgroundColor3 = Theme.BG
Main.BackgroundTransparency = 0.15
Main.BorderSizePixel = 0

--// LOAD SAVED POSITION
if Settings.GuiPos.X and Settings.GuiPos.Y then
    Main.Position = UDim2.new(0, Settings.GuiPos.X, 0, Settings.GuiPos.Y)
else
    Main.Position = UDim2.new(0.5,-115,0.5,-180)
end

Main.Parent = GUI

Instance.new("UICorner",Main).CornerRadius = UDim.new(0,14)

local Stroke = Instance.new("UIStroke",Main)
Stroke.Color = Theme.Accent
Stroke.Transparency = 0.5

local Grad = Instance.new("UIGradient",Main)
Grad.Rotation = 90
Grad.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0,Color3.fromRGB(45,30,75)),
    ColorSequenceKeypoint.new(1,Color3.fromRGB(15,10,25))
}

--// HEADER
local Header = Instance.new("TextLabel",Main)
Header.Size = UDim2.new(1,0,0,30)
Header.BackgroundTransparency = 1
Header.Text = "❄ FrostHub  |  Speed Bypass"
Header.Font = Enum.Font.GothamBold
Header.TextSize = 13
Header.TextColor3 = Theme.Accent

--// CONTENT
local Content = Instance.new("Frame",Main)
Content.Size = UDim2.new(1,-16,1,-46)
Content.Position = UDim2.new(0,8,0,38)
Content.BackgroundTransparency = 1

local List = Instance.new("UIListLayout",Content)
List.Padding = UDim.new(0,8)

--// BUTTON
local function Button(text)
    local B = Instance.new("TextButton")
    B.Size = UDim2.new(1,0,0,32)
    B.Text = text
    B.Font = Enum.Font.GothamBold
    B.TextSize = 12
    B.TextColor3 = Theme.Text
    B.BackgroundColor3 = Color3.fromRGB(35,25,60)
    B.AutoButtonColor = false

    Instance.new("UICorner",B).CornerRadius = UDim.new(0,8)
    local S = Instance.new("UIStroke",B)
    S.Color = Theme.AccentDark
    S.Transparency = 0.4

    B.Parent = Content
    return B
end

--// SLIDER
local function Slider(name,min,max,val,callback,isDecimal)
    local F = Instance.new("Frame",Content)
    F.Size = UDim2.new(1,0,0,44)
    F.BackgroundColor3 = Color3.fromRGB(30,20,50)
    Instance.new("UICorner",F).CornerRadius = UDim.new(0,8)

    local T = Instance.new("TextLabel",F)
    T.Text = name
    T.Font = Enum.Font.Gotham
    T.TextSize = 11
    T.TextColor3 = Theme.SubText
    T.BackgroundTransparency = 1
    T.Position = UDim2.new(0,8,0,4)

    local V = Instance.new("TextLabel",F)
    V.Text = tostring(val)
    V.Font = Enum.Font.GothamBold
    V.TextSize = 11
    V.TextColor3 = Theme.Accent
    V.BackgroundTransparency = 1
    V.Position = UDim2.new(1,-50,0,4)

    local Bar = Instance.new("Frame",F)
    Bar.Position = UDim2.new(0,8,1,-12)
    Bar.Size = UDim2.new(1,-16,0,3)
    Bar.BackgroundColor3 = Theme.AccentDark

    local Fill = Instance.new("Frame",Bar)
    Fill.BackgroundColor3 = Theme.Accent
    Fill.Size = UDim2.new((val-min)/(max-min),0,1,0)

    local Drag = Instance.new("TextButton",Bar)
    Drag.Size = UDim2.new(1,0,2,8)
    Drag.Position = UDim2.new(0,0,-0.5,0)
    Drag.BackgroundTransparency = 1
    Drag.Text = ""

    local dragging=false
    Drag.MouseButton1Down:Connect(function() dragging=true end)
    UserInputService.InputEnded:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 then
            dragging=false
            SaveConfig()
        end
    end)

    UserInputService.InputChanged:Connect(function(i)
        if dragging and i.UserInputType==Enum.UserInputType.MouseMovement then
            local p=math.clamp((i.Position.X-Bar.AbsolutePosition.X)/Bar.AbsoluteSize.X,0,1)
            Fill.Size=UDim2.new(p,0,1,0)
            local v=isDecimal and math.floor((min+(max-min)*p)*10)/10 or math.floor(min+(max-min)*p)
            V.Text=tostring(v)
            callback(v)
        end
    end)
end

--// UI ELEMENTS
local LagBtn = Button("Lag ❄ [X]")
local SpeedBtn = Button("Speed ❄ [F]")
local DeathBtn = Button("Anti-Death")
local AutoLagBtn = Button("Auto Lag")

Slider("Packet Rate",1,Settings.MaxPacketRate,Settings.PacketRate,function(v) Settings.PacketRate=v end)
Slider("Speed",Settings.MinSpeed,Settings.MaxSpeed,Settings.SpeedValue,function(v) Settings.SpeedValue=v end)
Slider("Lag Delay",0,2,Settings.LagStartDelay,function(v) Settings.LagStartDelay=v end,true)
Slider("Lag Time",0.1,5,Settings.LagDuration,function(v) Settings.LagDuration=v end,true)

--// BUTTON LOGIC
LagBtn.MouseButton1Click:Connect(function() Settings.LagEnabled=not Settings.LagEnabled end)
SpeedBtn.MouseButton1Click:Connect(function() Settings.SpeedEnabled=not Settings.SpeedEnabled end)
DeathBtn.MouseButton1Click:Connect(function() Settings.AntiDeathEnabled=not Settings.AntiDeathEnabled SaveConfig() end)
AutoLagBtn.MouseButton1Click:Connect(function() Settings.AutoLagOnPrompt=not Settings.AutoLagOnPrompt SaveConfig() end)

--// DRAG + SAVE POSITION
local dragging,dragStart,startPos
Main.InputBegan:Connect(function(i)
    if i.UserInputType==Enum.UserInputType.MouseButton1 then
        dragging=true
        dragStart=i.Position
        startPos=Main.Position
    end
end)

UserInputService.InputChanged:Connect(function(i)
    if dragging and i.UserInputType==Enum.UserInputType.MouseMovement then
        local d=i.Position-dragStart
        Main.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+d.X,startPos.Y.Scale,startPos.Y.Offset+d.Y)
    end
end)

UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType==Enum.UserInputType.MouseButton1 then
        dragging=false
        Settings.GuiPos.X = Main.Position.X.Offset
        Settings.GuiPos.Y = Main.Position.Y.Offset
        SaveConfig()
    end
end)

--// HOTKEYS
UserInputService.InputBegan:Connect(function(i,g)
    if g then return end
    if i.KeyCode==Enum.KeyCode.X then Settings.LagEnabled=not Settings.LagEnabled end
    if i.KeyCode==Enum.KeyCode.F then Settings.SpeedEnabled=not Settings.SpeedEnabled end
end)

--// SPEED + ANTI-DEATH
RunService.Heartbeat:Connect(function()
    local char=LocalPlayer.Character
    local hum=char and char:FindFirstChild("Humanoid")
    local root=char and char:FindFirstChild("HumanoidRootPart")

    if hum and root and Settings.SpeedEnabled and hum.MoveDirection.Magnitude>0 then
        root.Velocity=Vector3.new(
            hum.MoveDirection.X*Settings.SpeedValue,
            root.Velocity.Y,
            hum.MoveDirection.Z*Settings.SpeedValue
        )
    end

    if hum and Settings.AntiDeathEnabled then
        hum.Health=math.max(hum.Health,50)
        hum:SetStateEnabled(Enum.HumanoidStateType.Dead,false)
    end
end)
